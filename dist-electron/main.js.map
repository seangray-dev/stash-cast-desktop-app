{"version":3,"file":"main.js","sources":["../electron/main.ts"],"sourcesContent":["import {\r\n  app,\r\n  BrowserWindow,\r\n  desktopCapturer,\r\n  dialog,\r\n  ipcMain,\r\n  nativeImage,\r\n  systemPreferences,\r\n  Tray,\r\n} from 'electron';\r\nimport { spawn } from 'node:child_process';\r\nimport fs from 'node:fs/promises';\r\nimport { tmpdir } from 'node:os';\r\nimport path from 'node:path';\r\nimport { fileURLToPath } from 'node:url';\r\n\r\nconst __dirname = path.dirname(fileURLToPath(import.meta.url));\r\nconst applicationName = 'Stash Cast';\r\n\r\n// The built directory structure\r\n//\r\n// â”œâ”€â”¬â”€â”¬ dist\r\n// â”‚ â”‚ â””â”€â”€ index.html\r\n// â”‚ â”‚\r\n// â”‚ â”œâ”€â”¬ dist-electron\r\n// â”‚ â”‚ â”œâ”€â”€ main.js\r\n// â”‚ â”‚ â””â”€â”€ preload.mjs\r\n// â”‚\r\nprocess.env.APP_ROOT = path.join(__dirname, '..');\r\n\r\n// ðŸš§ Use ['ENV_NAME'] avoid vite:define plugin - Vite@2.x\r\nexport const VITE_DEV_SERVER_URL = process.env['VITE_DEV_SERVER_URL'];\r\nexport const MAIN_DIST = path.join(process.env.APP_ROOT, 'dist-electron');\r\nexport const RENDERER_DIST = path.join(process.env.APP_ROOT, 'dist');\r\n\r\nprocess.env.VITE_PUBLIC = VITE_DEV_SERVER_URL\r\n  ? path.join(process.env.APP_ROOT, 'public')\r\n  : RENDERER_DIST;\r\n\r\n// Window references\r\nlet tray: Tray | null = null;\r\nlet mainAppWindow: BrowserWindow | null = null;\r\nlet controlsWindow: BrowserWindow | null = null;\r\nlet cameraWindow: BrowserWindow | null = null;\r\n\r\nasync function checkAndRequestPermissions() {\r\n  if (process.platform === 'darwin') {\r\n    // Request camera permission\r\n    if (!systemPreferences.getMediaAccessStatus('camera')) {\r\n      await systemPreferences.askForMediaAccess('camera');\r\n    }\r\n\r\n    // Request microphone permission\r\n    if (!systemPreferences.getMediaAccessStatus('microphone')) {\r\n      await systemPreferences.askForMediaAccess('microphone');\r\n    }\r\n  }\r\n}\r\n\r\nfunction createMainAppWindow() {\r\n  mainAppWindow = new BrowserWindow({\r\n    width: 900,\r\n    height: 700,\r\n    minWidth: 320,\r\n    minHeight: 650,\r\n    titleBarStyle: 'default',\r\n    frame: false,\r\n    resizable: true,\r\n    movable: true,\r\n    show: true,\r\n    webPreferences: {\r\n      preload: path.join(__dirname, 'preload.mjs'),\r\n      nodeIntegration: false,\r\n      contextIsolation: true,\r\n    },\r\n  });\r\n\r\n  if (VITE_DEV_SERVER_URL) {\r\n    mainAppWindow.loadURL(`${VITE_DEV_SERVER_URL}`);\r\n  } else {\r\n    mainAppWindow.loadFile(path.join(RENDERER_DIST, 'index.html'));\r\n  }\r\n}\r\n\r\n// function createControlsWindow() {\r\n//   controlsWindow = new BrowserWindow({\r\n//     width: 200,\r\n//     height: 60,\r\n//     frame: false,\r\n//     resizable: false,\r\n//     movable: false,\r\n//     show: false,\r\n//     alwaysOnTop: true,\r\n//     transparent: true,\r\n//     webPreferences: {\r\n//       preload: path.join(__dirname, 'preload.mjs'),\r\n//     },\r\n//   });\r\n\r\n//   if (VITE_DEV_SERVER_URL) {\r\n//     controlsWindow.loadURL(`${VITE_DEV_SERVER_URL}/controls`);\r\n//   } else {\r\n//     controlsWindow.loadFile(path.join(RENDERER_DIST, 'controls.html'));\r\n//   }\r\n// }\r\n\r\nfunction createCameraWindow() {\r\n  console.log('Creating camera window...');\r\n  cameraWindow = new BrowserWindow({\r\n    width: 320,\r\n    height: 320,\r\n    frame: false,\r\n    transparent: true,\r\n    alwaysOnTop: true,\r\n    focusable: false,\r\n    hasShadow: false,\r\n    resizable: false,\r\n    movable: true,\r\n    webPreferences: {\r\n      preload: path.join(__dirname, 'preload.mjs'),\r\n      nodeIntegration: false,\r\n      contextIsolation: true,\r\n      devTools: true,\r\n      backgroundThrottling: false,\r\n    },\r\n    vibrancy: 'under-window',\r\n    visualEffectState: 'active',\r\n  });\r\n\r\n  // Set window to be transparent to mouse events except for the video\r\n  cameraWindow.setIgnoreMouseEvents(false);\r\n\r\n  if (VITE_DEV_SERVER_URL) {\r\n    console.log(\r\n      'Loading camera window URL:',\r\n      `${VITE_DEV_SERVER_URL}src/camera.html`\r\n    );\r\n    cameraWindow.loadURL(`${VITE_DEV_SERVER_URL}src/camera.html`);\r\n  } else {\r\n    const filePath = path.join(RENDERER_DIST, 'camera.html');\r\n    console.log('Loading camera window file:', filePath);\r\n    cameraWindow.loadFile(filePath);\r\n  }\r\n\r\n  // Add window load event logging\r\n  cameraWindow.webContents.on(\r\n    'did-fail-load',\r\n    (event, errorCode, errorDescription) => {\r\n      console.error(\r\n        'Camera window failed to load:',\r\n        errorCode,\r\n        errorDescription\r\n      );\r\n    }\r\n  );\r\n\r\n  cameraWindow.webContents.on('did-finish-load', () => {\r\n    console.log('Camera window loaded successfully');\r\n  });\r\n\r\n  // Open DevTools for debugging\r\n  cameraWindow.webContents.openDevTools({ mode: 'detach' });\r\n}\r\n\r\nfunction setupTray() {\r\n  const icon = nativeImage.createFromDataURL(\r\n    'data:image/png;base64,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'\r\n  );\r\n  tray = new Tray(icon);\r\n  tray.setToolTip(applicationName);\r\n\r\n  tray.on('click', () => {\r\n    if (!mainAppWindow?.isVisible()) {\r\n      mainAppWindow?.show();\r\n    }\r\n  });\r\n}\r\n\r\nasync function convertToMov(\r\n  inputPath: string,\r\n  outputPath: string\r\n): Promise<void> {\r\n  return new Promise((resolve, reject) => {\r\n    console.log('Starting FFmpeg conversion...');\r\n    console.log('Input path:', inputPath);\r\n    console.log('Output path:', outputPath);\r\n\r\n    // First pass: Analyze the input file\r\n    const ffprobe = spawn('ffprobe', [\r\n      '-v',\r\n      'error',\r\n      '-select_streams',\r\n      'v:0',\r\n      '-show_entries',\r\n      'stream=width,height,r_frame_rate,codec_name',\r\n      '-of',\r\n      'json',\r\n      inputPath,\r\n    ]);\r\n\r\n    let probeData = '';\r\n    ffprobe.stdout.on('data', (data) => {\r\n      probeData += data.toString();\r\n    });\r\n\r\n    ffprobe.on('close', async (code) => {\r\n      if (code !== 0) {\r\n        console.error('FFprobe analysis failed');\r\n\r\n        // Try direct conversion as fallback\r\n        await tryConversion(inputPath, outputPath, {}).catch(reject);\r\n        return;\r\n      }\r\n\r\n      try {\r\n        const info = JSON.parse(probeData);\r\n        console.log('Input video info:', info);\r\n\r\n        const conversionOptions = {\r\n          videoBitrate: '5M',\r\n          audioBitrate: '256k',\r\n          frameRate: info?.streams?.[0]?.r_frame_rate || '30',\r\n          width: info?.streams?.[0]?.width,\r\n          height: info?.streams?.[0]?.height,\r\n        };\r\n\r\n        await tryConversion(inputPath, outputPath, conversionOptions);\r\n        resolve();\r\n      } catch (error) {\r\n        console.error('Error parsing probe data:', error);\r\n        reject(error);\r\n      }\r\n    });\r\n  });\r\n}\r\n\r\nasync function tryConversion(\r\n  inputPath: string,\r\n  outputPath: string,\r\n  options: any\r\n): Promise<void> {\r\n  return new Promise((resolve, reject) => {\r\n    // High quality H.264 settings for optimal quality/size ratio\r\n    const ffmpegArgs = [\r\n      '-y', // Overwrite output file\r\n      '-i',\r\n      inputPath, // Input file\r\n      // Video settings\r\n      '-c:v',\r\n      'h264', // H.264 codec\r\n      '-preset',\r\n      'slow', // Slower encoding = better compression\r\n      '-crf',\r\n      '18', // Constant Rate Factor (18-23 is visually lossless)\r\n      '-profile:v',\r\n      'high', // High profile for better quality\r\n      '-level',\r\n      '4.2', // Compatibility level\r\n      '-movflags',\r\n      '+faststart', // Enable streaming\r\n      // Color settings\r\n      '-pix_fmt',\r\n      'yuv420p', // Standard color space for better compatibility\r\n      // Audio settings\r\n      '-c:a',\r\n      'aac', // AAC audio codec\r\n      '-b:a',\r\n      '320k', // High quality audio bitrate\r\n      '-ar',\r\n      '48000', // Audio sample rate\r\n      '-ac',\r\n      '2', // Stereo audio\r\n    ];\r\n\r\n    // Add framerate if specified\r\n    if (options.frameRate) {\r\n      ffmpegArgs.push('-r', options.frameRate);\r\n    }\r\n\r\n    // Add output file\r\n    ffmpegArgs.push(outputPath);\r\n\r\n    console.log('FFmpeg arguments:', ffmpegArgs);\r\n\r\n    const ffmpeg = spawn('ffmpeg', ffmpegArgs);\r\n\r\n    let errorLog = '';\r\n\r\n    ffmpeg.stderr.on('data', (data) => {\r\n      const message = data.toString();\r\n      errorLog += message;\r\n      console.log('FFmpeg:', message);\r\n    });\r\n\r\n    ffmpeg.on('close', (code) => {\r\n      if (code === 0) {\r\n        console.log('FFmpeg conversion successful');\r\n        resolve();\r\n      } else {\r\n        console.error('FFmpeg conversion failed with code:', code);\r\n        console.error('Error log:', errorLog);\r\n        reject(new Error(`FFmpeg conversion failed: ${errorLog}`));\r\n      }\r\n    });\r\n\r\n    ffmpeg.on('error', (err) => {\r\n      console.error('FFmpeg process error:', err);\r\n      reject(err);\r\n    });\r\n  });\r\n}\r\n\r\nfunction setupIPC() {\r\n  ipcMain.handle('getSources', async (_event: Electron.IpcMainInvokeEvent) => {\r\n    const screens = await desktopCapturer.getSources({\r\n      types: ['screen'],\r\n      thumbnailSize: { width: 150, height: 150 },\r\n    });\r\n\r\n    const windows = await desktopCapturer.getSources({\r\n      types: ['window'],\r\n      thumbnailSize: { width: 150, height: 150 },\r\n    });\r\n\r\n    const screenThumbnails = screens.map((screen) => {\r\n      return {\r\n        id: screen.id,\r\n        name: screen.name,\r\n        thumbnail: screen.thumbnail.toDataURL(),\r\n        display_id: screen.display_id,\r\n        appIcon: screen.appIcon,\r\n      };\r\n    });\r\n\r\n    const windowThumbnails = windows.map((window) => {\r\n      return {\r\n        id: window.id,\r\n        name: window.name,\r\n        thumbnail: window.thumbnail.toDataURL(),\r\n        display_id: window.display_id,\r\n        appIcon: window.appIcon,\r\n      };\r\n    });\r\n\r\n    const sources = [...screenThumbnails, ...windowThumbnails];\r\n\r\n    return sources;\r\n  });\r\n\r\n  // Updated save-recording handler\r\n  ipcMain.handle('save-recording', async (_event, { buffer, mimeType }) => {\r\n    try {\r\n      // Create temporary WebM file\r\n      const tempWebM = path.join(tmpdir(), `temp-${Date.now()}.webm`);\r\n      console.log('Creating temporary WebM file:', tempWebM);\r\n\r\n      await fs.writeFile(tempWebM, Buffer.from(buffer));\r\n      const stats = await fs.stat(tempWebM);\r\n      console.log('Temporary WebM file created:', {\r\n        size: stats.size,\r\n        mimeType,\r\n      });\r\n\r\n      // Show save dialog for final MOV file\r\n      const { filePath, canceled } = await dialog.showSaveDialog({\r\n        defaultPath: path.join(\r\n          app.getPath('desktop'),\r\n          `recording-${Date.now()}.mov`\r\n        ),\r\n        filters: [{ name: 'QuickTime Movie', extensions: ['mov'] }],\r\n      });\r\n\r\n      if (canceled || !filePath) {\r\n        console.log('Save dialog was canceled');\r\n        await fs.unlink(tempWebM).catch(console.error);\r\n        return { success: false, error: 'Save dialog was canceled' };\r\n      }\r\n\r\n      console.log('Starting conversion to:', filePath);\r\n      await convertToMov(tempWebM, filePath);\r\n      console.log('Conversion completed successfully');\r\n\r\n      // Clean up temp file\r\n      await fs.unlink(tempWebM).catch(console.error);\r\n      console.log('Temporary file cleaned up');\r\n\r\n      return { success: true, filePath };\r\n    } catch (error) {\r\n      console.error('Failed to save recording:', error);\r\n      return {\r\n        success: false,\r\n        error:\r\n          error instanceof Error ? error.message : 'Unknown error occurred',\r\n      };\r\n    }\r\n  });\r\n\r\n  ipcMain.on('start-recording', () => {\r\n    console.log('Recording started');\r\n  });\r\n\r\n  ipcMain.on('stop-recording', () => {\r\n    console.log('Recording stopped');\r\n  });\r\n\r\n  ipcMain.on('close-app', () => {\r\n    app.quit();\r\n  });\r\n\r\n  ipcMain.on('show-camera-window', () => {\r\n    console.log('Received show-camera-window event');\r\n    if (!cameraWindow) {\r\n      console.log('No camera window exists, creating new one');\r\n      createCameraWindow();\r\n    } else {\r\n      console.log('Camera window exists, showing it');\r\n      if (cameraWindow.isDestroyed()) {\r\n        console.log('Camera window was destroyed, creating new one');\r\n        createCameraWindow();\r\n      } else {\r\n        cameraWindow.showInactive();\r\n      }\r\n    }\r\n  });\r\n\r\n  ipcMain.on('camera-stream-ready', (event, streamInfo) => {\r\n    console.log('Received camera-stream-ready event:', streamInfo);\r\n    if (cameraWindow && !cameraWindow.isDestroyed()) {\r\n      console.log('Forwarding stream info to camera window');\r\n      cameraWindow.webContents.send('camera-stream-ready', streamInfo);\r\n    } else {\r\n      console.log('Camera window not available to receive stream');\r\n    }\r\n  });\r\n\r\n  ipcMain.on('hide-camera-window', () => {\r\n    console.log('Received hide-camera-window event');\r\n    if (cameraWindow && !cameraWindow.isDestroyed()) {\r\n      cameraWindow.hide();\r\n    }\r\n  });\r\n\r\n  ipcMain.on('set-camera-window-position', (_event, { x, y }) => {\r\n    if (cameraWindow && !cameraWindow.isDestroyed()) {\r\n      cameraWindow.setPosition(x, y);\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('get-display-info', (_event, displayId) => {\r\n    const display = require('electron').screen.getDisplayMatching({\r\n      x: 0,\r\n      y: 0,\r\n      width: 1,\r\n      height: 1,\r\n      displayId: displayId,\r\n    });\r\n    return display;\r\n  });\r\n}\r\n\r\napp.whenReady().then(async () => {\r\n  await checkAndRequestPermissions();\r\n  setupIPC();\r\n  setupTray();\r\n  createMainAppWindow();\r\n});\r\n\r\n// Keep the app running when all windows are closed\r\napp.on('window-all-closed', () => {\r\n  if (process.platform !== 'darwin') {\r\n    app.quit();\r\n  }\r\n});\r\n\r\n// Handle macOS dock icon clicks\r\napp.on('activate', () => {\r\n  if (BrowserWindow.getAllWindows().length === 0) {\r\n    createMainAppWindow();\r\n  }\r\n});\r\n"],"names":[],"mappings":"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"}