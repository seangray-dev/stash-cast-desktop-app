{"version":3,"file":"main.js","sources":["../src/utils/hardware-detect.ts","../src/services/ffmpeg/quality-presets.ts","../src/services/ffmpeg/index.ts","../electron/main.ts"],"sourcesContent":["import { spawn } from 'child_process';\nimport type { HardwareAcceleration } from '../services/ffmpeg/types';\n\nexport async function detectHardwareAcceleration(): Promise<HardwareAcceleration> {\n  return new Promise((resolve) => {\n    const ffmpeg = spawn('ffmpeg', ['-encoders']);\n    let output = '';\n\n    ffmpeg.stdout.on('data', (data) => {\n      output += data.toString();\n    });\n\n    ffmpeg.stderr.on('data', (data) => {\n      output += data.toString();\n    });\n\n    ffmpeg.on('close', () => {\n      // Check for available hardware encoders\n      if (\n        process.platform === 'darwin' &&\n        output.includes('h264_videotoolbox')\n      ) {\n        resolve({\n          type: 'videotoolbox',\n          available: true,\n          name: 'Apple VideoToolbox',\n        });\n      } else if (output.includes('h264_nvenc')) {\n        resolve({\n          type: 'nvenc',\n          available: true,\n          name: 'NVIDIA NVENC',\n        });\n      } else if (output.includes('h264_qsv')) {\n        resolve({\n          type: 'qsv',\n          available: true,\n          name: 'Intel Quick Sync',\n        });\n      } else if (output.includes('h264_amf')) {\n        resolve({\n          type: 'amf',\n          available: true,\n          name: 'AMD AMF',\n        });\n      } else {\n        resolve({\n          type: 'none',\n          available: false,\n          name: 'Software Encoding',\n        });\n      }\n    });\n\n    // Fallback in case of error\n    ffmpeg.on('error', () => {\n      resolve({\n        type: 'none',\n        available: false,\n        name: 'Software Encoding',\n      });\n    });\n  });\n}\n\nexport function getEncoderSettings(hwAccel: HardwareAcceleration): string[] {\n  switch (hwAccel.type) {\n    case 'videotoolbox':\n      return ['-c:v', 'h264_videotoolbox'];\n    case 'nvenc':\n      return ['-c:v', 'h264_nvenc', '-preset', 'p7', '-tune', 'hq'];\n    case 'qsv':\n      return ['-c:v', 'h264_qsv', '-preset', 'veryslow'];\n    case 'amf':\n      return ['-c:v', 'h264_amf', '-quality', 'quality'];\n    default:\n      return ['-c:v', 'libx264']; // Software encoding\n  }\n}\n","export interface VideoQualitySettings {\n  width: number;\n  height: number;\n  videoBitrate: string;\n  audioBitrate: string;\n  crf: number;\n}\n\nexport const VIDEO_QUALITY_PRESETS: Record<string, VideoQualitySettings> = {\n  '2160p': {\n    width: 3840,\n    height: 2160,\n    videoBitrate: '45M',\n    audioBitrate: '384k',\n    crf: 18,\n  },\n  '1440p': {\n    width: 2560,\n    height: 1440,\n    videoBitrate: '16M',\n    audioBitrate: '256k',\n    crf: 20,\n  },\n  '1080p': {\n    width: 1920,\n    height: 1080,\n    videoBitrate: '8M',\n    audioBitrate: '192k',\n    crf: 22,\n  },\n  '720p': {\n    width: 1280,\n    height: 720,\n    videoBitrate: '5M',\n    audioBitrate: '128k',\n    crf: 23,\n  },\n  '480p': {\n    width: 854,\n    height: 480,\n    videoBitrate: '2.5M',\n    audioBitrate: '96k',\n    crf: 25,\n  },\n};\n","import { spawn } from 'child_process';\nimport { promises as fs } from 'fs';\nimport { tmpdir } from 'os';\nimport { join } from 'path';\nimport {\n  detectHardwareAcceleration,\n  getEncoderSettings,\n} from '../../utils/hardware-detect';\nimport { VIDEO_QUALITY_PRESETS } from './quality-presets';\nimport type {\n  ConversionProgress,\n  ConversionResult,\n  FFmpegSettings,\n  HardwareAcceleration,\n} from './types';\n\nexport class FFmpegService {\n  private hwAccel: HardwareAcceleration | null = null;\n  private defaultSettings: FFmpegSettings = {\n    useHardwareAcceleration: true,\n    preset: 'medium',\n    crf: 23,\n    audioQuality: 3,\n    maxBitrate: '5M',\n    quality: '1080p', // Default to 1080p\n    maintainAspectRatio: true,\n  };\n\n  constructor() {\n    this.initializeHardwareAcceleration();\n  }\n\n  private async initializeHardwareAcceleration() {\n    this.hwAccel = await detectHardwareAcceleration();\n    console.log('Hardware acceleration:', this.hwAccel);\n  }\n\n  private getFFmpegArgs(\n    inputPath: string,\n    outputPath: string,\n    settings: FFmpegSettings\n  ): string[] {\n    const args = [\n      '-y', // Overwrite output file\n      '-i',\n      inputPath, // Input file\n    ];\n\n    // Add hardware acceleration if available and enabled\n    if (settings.useHardwareAcceleration && this.hwAccel?.available) {\n      args.push(...getEncoderSettings(this.hwAccel));\n    } else {\n      args.push('-c:v', 'libx264'); // Software encoding\n    }\n\n    // Apply quality preset if specified\n    if (settings.quality && VIDEO_QUALITY_PRESETS[settings.quality]) {\n      const preset = VIDEO_QUALITY_PRESETS[settings.quality];\n      args.push(\n        '-vf',\n        `scale=${preset.width}:${preset.height}${settings.maintainAspectRatio ? ':force_original_aspect_ratio=decrease' : ''}`,\n        '-b:v',\n        preset.videoBitrate,\n        '-b:a',\n        preset.audioBitrate,\n        '-crf',\n        preset.crf.toString()\n      );\n    } else if (settings.width && settings.height) {\n      // Use custom dimensions if specified\n      args.push(\n        '-vf',\n        `scale=${settings.width}:${settings.height}${settings.maintainAspectRatio ? ':force_original_aspect_ratio=decrease' : ''}`\n      );\n    }\n\n    // Add encoding settings\n    args.push(\n      '-preset',\n      settings.preset,\n      // Audio settings\n      '-c:a',\n      'aac',\n      '-q:a',\n      settings.audioQuality.toString(),\n      '-ar',\n      '48000', // Audio sample rate\n      '-ac',\n      '2', // Stereo audio\n      // Additional optimizations\n      '-movflags',\n      '+faststart',\n      '-pix_fmt',\n      'yuv420p'\n    );\n\n    // Add max bitrate if specified and not using quality preset\n    if (settings.maxBitrate && !settings.quality) {\n      args.push(\n        '-maxrate',\n        settings.maxBitrate,\n        '-bufsize',\n        settings.maxBitrate\n      );\n    }\n\n    // Add custom bitrates if specified and not using quality preset\n    if (!settings.quality) {\n      if (settings.videoBitrate) {\n        args.push('-b:v', settings.videoBitrate);\n      }\n      if (settings.audioBitrate) {\n        args.push('-b:a', settings.audioBitrate);\n      }\n    }\n\n    args.push(outputPath);\n    return args;\n  }\n\n  public async convertVideo(\n    inputBuffer: Uint8Array,\n    outputPath: string,\n    settings: Partial<FFmpegSettings> = {},\n    onProgress?: (progress: ConversionProgress) => void\n  ): Promise<ConversionResult> {\n    try {\n      // Create temporary input file\n      const tempInput = join(tmpdir(), `temp-${Date.now()}.webm`);\n      await fs.writeFile(tempInput, Buffer.from(inputBuffer));\n\n      // Merge settings with defaults\n      const finalSettings: FFmpegSettings = {\n        ...this.defaultSettings,\n        ...settings,\n      };\n\n      return new Promise((resolve, reject) => {\n        const args = this.getFFmpegArgs(tempInput, outputPath, finalSettings);\n        console.log('FFmpeg arguments:', args);\n\n        const ffmpeg = spawn('ffmpeg', args);\n        let duration = 0;\n        let errorLog = '';\n\n        ffmpeg.stderr.on('data', (data) => {\n          const message = data.toString();\n\n          // Extract duration if not already found\n          if (!duration) {\n            const match = message.match(/Duration: (\\d{2}):(\\d{2}):(\\d{2})/);\n            if (match) {\n              duration =\n                parseInt(match[1]) * 3600 +\n                parseInt(match[2]) * 60 +\n                parseInt(match[3]);\n            }\n          }\n\n          // Parse progress\n          const timeMatch = message.match(/time=(\\d{2}):(\\d{2}):(\\d{2})/);\n          if (timeMatch && duration && onProgress) {\n            const time =\n              parseInt(timeMatch[1]) * 3600 +\n              parseInt(timeMatch[2]) * 60 +\n              parseInt(timeMatch[3]);\n            const progress: ConversionProgress = {\n              percent: (time / duration) * 100,\n              frame: 0, // TODO: Parse frame info\n              fps: 0, // TODO: Parse FPS\n              time: `${timeMatch[1]}:${timeMatch[2]}:${timeMatch[3]}`,\n              bitrate: '0', // TODO: Parse bitrate\n              size: '0', // TODO: Parse size\n            };\n            onProgress(progress);\n          }\n\n          errorLog += message;\n        });\n\n        ffmpeg.on('close', async (code) => {\n          try {\n            // Clean up temp file\n            await fs.unlink(tempInput);\n\n            if (code === 0) {\n              const fileInfo = await fs.stat(outputPath);\n              resolve({\n                success: true,\n                outputPath,\n                duration,\n                size: fileInfo.size,\n              });\n            } else {\n              reject(new Error(`FFmpeg conversion failed: ${errorLog}`));\n            }\n          } catch (error) {\n            reject(error);\n          }\n        });\n\n        ffmpeg.on('error', (error) => {\n          fs.unlink(tempInput).catch(console.error);\n          reject(error);\n        });\n      });\n    } catch (error) {\n      throw new Error(\n        `Failed to convert video: ${error instanceof Error ? error.message : 'Unknown error'}`\n      );\n    }\n  }\n\n  public getHardwareAcceleration(): HardwareAcceleration | null {\n    return this.hwAccel;\n  }\n\n  public async updateSettings(settings: Partial<FFmpegSettings>) {\n    this.defaultSettings = {\n      ...this.defaultSettings,\n      ...settings,\n    };\n  }\n}\n","import {\r\n  app,\r\n  BrowserWindow,\r\n  desktopCapturer,\r\n  dialog,\r\n  ipcMain,\r\n  nativeImage,\r\n  systemPreferences,\r\n  Tray,\r\n} from 'electron';\r\nimport fs from 'node:fs/promises';\r\nimport { tmpdir } from 'node:os';\r\nimport path from 'node:path';\r\nimport { fileURLToPath } from 'node:url';\r\nimport { FFmpegService } from '../src/services/ffmpeg';\r\n\r\nconst __dirname = path.dirname(fileURLToPath(import.meta.url));\r\nconst applicationName = 'Stash Cast';\r\n\r\n// Initialize FFmpeg service\r\nconst ffmpegService = new FFmpegService();\r\n\r\n// The built directory structure\r\n//\r\n// â”œâ”€â”¬â”€â”¬ dist\r\n// â”‚ â”‚ â””â”€â”€ index.html\r\n// â”‚ â”‚\r\n// â”‚ â”œâ”€â”¬ dist-electron\r\n// â”‚ â”‚ â”œâ”€â”€ main.js\r\n// â”‚ â”‚ â””â”€â”€ preload.mjs\r\n// â”‚\r\nprocess.env.APP_ROOT = path.join(__dirname, '..');\r\n\r\n// ðŸš§ Use ['ENV_NAME'] avoid vite:define plugin - Vite@2.x\r\nexport const VITE_DEV_SERVER_URL = process.env['VITE_DEV_SERVER_URL'];\r\nexport const MAIN_DIST = path.join(process.env.APP_ROOT, 'dist-electron');\r\nexport const RENDERER_DIST = path.join(process.env.APP_ROOT, 'dist');\r\n\r\nprocess.env.VITE_PUBLIC = VITE_DEV_SERVER_URL\r\n  ? path.join(process.env.APP_ROOT, 'public')\r\n  : RENDERER_DIST;\r\n\r\n// Window references\r\nlet tray: Tray | null = null;\r\nlet mainAppWindow: BrowserWindow | null = null;\r\nlet cameraWindow: BrowserWindow | null = null;\r\n\r\nasync function checkAndRequestPermissions() {\r\n  if (process.platform === 'darwin') {\r\n    // Request camera permission\r\n    if (!systemPreferences.getMediaAccessStatus('camera')) {\r\n      await systemPreferences.askForMediaAccess('camera');\r\n    }\r\n\r\n    // Request microphone permission\r\n    if (!systemPreferences.getMediaAccessStatus('microphone')) {\r\n      await systemPreferences.askForMediaAccess('microphone');\r\n    }\r\n  }\r\n}\r\n\r\nfunction createMainAppWindow() {\r\n  mainAppWindow = new BrowserWindow({\r\n    width: 900,\r\n    height: 700,\r\n    minWidth: 320,\r\n    minHeight: 650,\r\n    titleBarStyle: 'default',\r\n    frame: false,\r\n    resizable: true,\r\n    movable: true,\r\n    show: true,\r\n    webPreferences: {\r\n      preload: path.join(__dirname, 'preload.mjs'),\r\n      nodeIntegration: false,\r\n      contextIsolation: true,\r\n    },\r\n  });\r\n\r\n  if (VITE_DEV_SERVER_URL) {\r\n    mainAppWindow.loadURL(`${VITE_DEV_SERVER_URL}`);\r\n  } else {\r\n    mainAppWindow.loadFile(path.join(RENDERER_DIST, 'index.html'));\r\n  }\r\n}\r\n\r\nfunction createCameraWindow() {\r\n  console.log('Creating camera window...');\r\n  cameraWindow = new BrowserWindow({\r\n    width: 320,\r\n    height: 320,\r\n    frame: false,\r\n    transparent: true,\r\n    alwaysOnTop: true,\r\n    focusable: false,\r\n    hasShadow: false,\r\n    resizable: false,\r\n    movable: true,\r\n    webPreferences: {\r\n      preload: path.join(__dirname, 'preload.mjs'),\r\n      nodeIntegration: false,\r\n      contextIsolation: true,\r\n      devTools: true,\r\n      backgroundThrottling: false,\r\n    },\r\n    vibrancy: 'under-window',\r\n    visualEffectState: 'active',\r\n  });\r\n\r\n  // Set window to be transparent to mouse events except for the video\r\n  cameraWindow.setIgnoreMouseEvents(false);\r\n\r\n  if (VITE_DEV_SERVER_URL) {\r\n    cameraWindow.loadURL(`${VITE_DEV_SERVER_URL}src/camera.html`);\r\n  } else {\r\n    const filePath = path.join(RENDERER_DIST, 'camera.html');\r\n    cameraWindow.loadFile(filePath);\r\n  }\r\n}\r\n\r\nfunction setupTray() {\r\n  const icon = nativeImage.createFromDataURL(\r\n    'data:image/png;base64,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'\r\n  );\r\n  tray = new Tray(icon);\r\n  tray.setToolTip(applicationName);\r\n\r\n  tray.on('click', () => {\r\n    if (!mainAppWindow?.isVisible()) {\r\n      mainAppWindow?.show();\r\n    }\r\n  });\r\n}\r\n\r\nfunction setupIPC() {\r\n  ipcMain.handle('getSources', async (_event: Electron.IpcMainInvokeEvent) => {\r\n    const screens = await desktopCapturer.getSources({\r\n      types: ['screen'],\r\n      thumbnailSize: { width: 150, height: 150 },\r\n    });\r\n\r\n    const windows = await desktopCapturer.getSources({\r\n      types: ['window'],\r\n      thumbnailSize: { width: 150, height: 150 },\r\n    });\r\n\r\n    const screenThumbnails = screens.map((screen) => {\r\n      return {\r\n        id: screen.id,\r\n        name: screen.name,\r\n        thumbnail: screen.thumbnail.toDataURL(),\r\n        display_id: screen.display_id,\r\n        appIcon: screen.appIcon,\r\n      };\r\n    });\r\n\r\n    const windowThumbnails = windows.map((window) => {\r\n      return {\r\n        id: window.id,\r\n        name: window.name,\r\n        thumbnail: window.thumbnail.toDataURL(),\r\n        display_id: window.display_id,\r\n        appIcon: window.appIcon,\r\n      };\r\n    });\r\n\r\n    const sources = [...screenThumbnails, ...windowThumbnails];\r\n\r\n    return sources;\r\n  });\r\n\r\n  // Updated save-recording handler\r\n  ipcMain.handle(\r\n    'save-recording',\r\n    async (_event, { buffer, mimeType, options }) => {\r\n      try {\r\n        // Create temporary WebM file\r\n        const tempWebM = path.join(tmpdir(), `temp-${Date.now()}.webm`);\r\n        console.log('Creating temporary WebM file:', tempWebM);\r\n\r\n        await fs.writeFile(tempWebM, Buffer.from(buffer));\r\n        const stats = await fs.stat(tempWebM);\r\n        console.log('Temporary WebM file created:', {\r\n          size: stats.size,\r\n          mimeType,\r\n        });\r\n\r\n        // Show save dialog for final MOV file\r\n        const { filePath, canceled } = await dialog.showSaveDialog({\r\n          defaultPath: path.join(\r\n            app.getPath('desktop'),\r\n            `recording-${Date.now()}.mov`\r\n          ),\r\n          filters: [{ name: 'QuickTime Movie', extensions: ['mov'] }],\r\n        });\r\n\r\n        if (canceled || !filePath) {\r\n          console.log('Save dialog was canceled');\r\n          await fs.unlink(tempWebM).catch(console.error);\r\n          return { success: false, error: 'Save dialog was canceled' };\r\n        }\r\n\r\n        try {\r\n          // Convert the video using FFmpeg\r\n          const result = await ffmpegService.convertVideo(\r\n            buffer,\r\n            filePath,\r\n            {\r\n              useHardwareAcceleration: options?.useHardwareAcceleration ?? true,\r\n              preset: 'medium',\r\n              crf: 23,\r\n              audioQuality: 3,\r\n              maxBitrate: '5M',\r\n            },\r\n            (progress) => {\r\n              // Forward progress to renderer\r\n              mainAppWindow?.webContents.send('conversion-progress', progress);\r\n            }\r\n          );\r\n\r\n          // Clean up temp file\r\n          await fs.unlink(tempWebM).catch(console.error);\r\n          return { success: true, filePath: result.outputPath };\r\n        } catch (error) {\r\n          await fs.unlink(tempWebM).catch(console.error);\r\n          return {\r\n            success: false,\r\n            error: error instanceof Error ? error.message : 'Conversion failed',\r\n          };\r\n        }\r\n      } catch (error) {\r\n        console.error('Failed to save recording:', error);\r\n        return {\r\n          success: false,\r\n          error:\r\n            error instanceof Error ? error.message : 'Unknown error occurred',\r\n        };\r\n      }\r\n    }\r\n  );\r\n\r\n  ipcMain.on('start-recording', () => {\r\n    console.log('Recording started');\r\n  });\r\n\r\n  ipcMain.on('stop-recording', () => {\r\n    console.log('Recording stopped');\r\n  });\r\n\r\n  ipcMain.on('close-app', () => {\r\n    app.quit();\r\n  });\r\n\r\n  ipcMain.on('show-camera-window', () => {\r\n    console.log('Received show-camera-window event');\r\n    if (!cameraWindow) {\r\n      console.log('No camera window exists, creating new one');\r\n      createCameraWindow();\r\n    } else {\r\n      console.log('Camera window exists, showing it');\r\n      if (cameraWindow.isDestroyed()) {\r\n        console.log('Camera window was destroyed, creating new one');\r\n        createCameraWindow();\r\n      } else {\r\n        cameraWindow.showInactive();\r\n      }\r\n    }\r\n  });\r\n\r\n  ipcMain.on('camera-stream-ready', (event, streamInfo) => {\r\n    console.log('Received camera-stream-ready event:', streamInfo);\r\n    if (cameraWindow && !cameraWindow.isDestroyed()) {\r\n      console.log('Forwarding stream info to camera window');\r\n      cameraWindow.webContents.send('camera-stream-ready', streamInfo);\r\n    } else {\r\n      console.log('Camera window not available to receive stream');\r\n    }\r\n  });\r\n\r\n  ipcMain.on('hide-camera-window', () => {\r\n    if (cameraWindow && !cameraWindow.isDestroyed()) {\r\n      cameraWindow.hide();\r\n    }\r\n  });\r\n\r\n  ipcMain.on('set-camera-window-position', (_event, { x, y }) => {\r\n    if (cameraWindow && !cameraWindow.isDestroyed()) {\r\n      cameraWindow.setPosition(x, y);\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('get-display-info', (_event, displayId) => {\r\n    const display = require('electron').screen.getDisplayMatching({\r\n      x: 0,\r\n      y: 0,\r\n      width: 1,\r\n      height: 1,\r\n      displayId: displayId,\r\n    });\r\n    return display;\r\n  });\r\n\r\n  // Add hardware acceleration detection handler\r\n  ipcMain.handle('get-hardware-acceleration', async () => {\r\n    return {\r\n      type: 'none',\r\n      available: false,\r\n      name: 'Software Encoding',\r\n    };\r\n  });\r\n\r\n  // Add settings update handler\r\n  ipcMain.handle('update-ffmpeg-settings', async (_event, settings) => {\r\n    return false;\r\n  });\r\n}\r\n\r\napp.whenReady().then(async () => {\r\n  await checkAndRequestPermissions();\r\n  setupIPC();\r\n  setupTray();\r\n  createMainAppWindow();\r\n});\r\n\r\n// Keep the app running when all windows are closed\r\napp.on('window-all-closed', () => {\r\n  if (process.platform !== 'darwin') {\r\n    app.quit();\r\n  }\r\n});\r\n\r\n// Handle macOS dock icon clicks\r\napp.on('activate', () => {\r\n  if (BrowserWindow.getAllWindows().length === 0) {\r\n    createMainAppWindow();\r\n  }\r\n});\r\n"],"names":["fs","tmpdir"],"mappings":"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"}